<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Usulan & Masukan - Pra Pertemuan Pekerja Gereja ke-4 Tahun 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
  body {
    margin: 0;
    color: #222;
    background: linear-gradient(120deg, #fdfaff, #f7fbff, #fffdf5);
    background-size: 300% 300%;
    animation: bgShift 25s ease infinite;
    position: relative;
    overflow-x: hidden;
  }
  @keyframes bgShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .logo-bg {
    position: fixed;
    inset: 0;
    background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png') center/40% no-repeat;
    opacity: 0.07;
    z-index: -1;
    pointer-events: none;
    mix-blend-mode: soft-light;
  }

  header {
    position: relative;
    text-align: center;
    color: white;
    padding: 2.3rem 1rem;
    overflow: hidden;
    background: linear-gradient(270deg, #1e3a8a, #4c1d95, #9333ea, #2563eb);
    background-size: 400% 400%;
    animation: headerAurora 20s ease infinite;
  }
  @keyframes headerAurora {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  header::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150px;
    height: 150px;
    background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png') no-repeat center/contain;
    opacity: 0.12;
    transform: translate(-50%, -50%);
    animation: pulse 8s ease-in-out infinite alternate;
  }
  @keyframes pulse {
    from { filter: drop-shadow(0 0 5px rgba(255,255,255,0.4)); }
    to { filter: drop-shadow(0 0 25px rgba(255,255,255,0.9)); }
  }

  form, section {
    background: rgba(255,255,255,0.93);
    border-radius: 18px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    width: 92%;
    max-width: 880px;
    padding: 1.8rem;
    margin: 2rem auto 1.5rem;
    position: relative;
    z-index: 2;
  }

  label { display: flex; flex-direction: column; margin-bottom: 1rem; font-weight: 500; }
  input, select, textarea {
    margin-top: .4rem;
    padding: .7rem;
    border: 1px solid #ccc;
    border-radius: 10px;
    font-size: 1rem;
    transition: 0.25s ease;
  }
  textarea { min-height: 120px; resize: vertical; }
  input:focus, select:focus, textarea:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 6px #93c5fd;
    outline: none;
  }

  fieldset { border: none; margin-top: 1rem; }
  legend { font-weight: 600; margin-bottom: .7rem; color: #1e3a8a; }
  .grid { display: grid; gap: .8rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }

  .actions { display: flex; justify-content: center; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; }
  button {
    border: none; padding: .9rem 1.6rem; border-radius: 10px;
    cursor: pointer; font-weight: 600; color: #fff;
    background: linear-gradient(90deg, #2563eb, #7c3aed, #9333ea);
    background-size: 200% 200%;
    animation: btnMove 6s ease infinite;
    transition: transform .25s ease;
  }
  @keyframes btnMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  button:hover { transform: scale(1.05); box-shadow: 0 0 10px rgba(147,51,234,0.3); }

  .reload-btn {
    background: linear-gradient(90deg, #059669, #10b981);
    margin-bottom: 0.8rem;
  }

  table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background: #c7d2fe; color: #1e1e1e; }
  tr:nth-child(even) { background: #f3f4f6; }

  #statusMsg { text-align: center; margin-top: 1rem; font-size: 0.85rem; color: #444; }

  footer {
    background: linear-gradient(90deg, #2563eb, #7c3aed, #9333ea);
    background-size: 600% 600%;
    animation: footerFlow 20s ease infinite;
    color: white; text-align: center;
    padding: 0.9rem; font-size: 0.85rem;
  }
</style>
</head>

<body>
<div class="logo-bg"></div>

<header>
  <h1>üïäÔ∏è Usulan, Masukan & Pendapat</h1>
  <p>Pra Pertemuan Pekerja Gereja ke-4 Tahun 2025</p>
  <p>Jemaat GKE Yerusalem Tamiang Layang</p>
</header>

<main>
<form id="usulanForm">
  <label>Tanggal
    <input type="date" name="tanggal" required>
  </label>

  <label>Kelompok Pekerja Gereja
    <select name="kelompok" required>
      <option value="">-- Pilih Kelompok --</option>
      <option>Pendeta/Vicaris</option>
      <option>BPP</option>
      <option>Pengurus Lingkungan Sion</option>
      <option>Pengurus Lingkungan Betlehem</option>
      <option>Pengurus Lingkungan Betania</option>
      <option>Pengurus Lingkungan Siloam</option>
      <option>Seksi Pelayanan Anak</option>
      <option>Seksi Pelayanan Remaja dan Pemuda</option>
      <option>Seksi Pelayanan Perempuan</option>
      <option>Seksi Pelayanan Bapak</option>
      <option>Seksi Pelayanan Lansia</option>
      <option>Tim Multimedia</option>
      <option>Tim Musik</option>
      <option>Song Leaders</option>
      <option>Operator LCD</option>
      <option>Operator Sound System</option>
      <option>Organis/Pemain Musik</option>
      <option>Koster Gereja Efata</option>
      <option>Koster Gereja Maranatha</option>
      <option>Panitia Pembangunan dan Pemeliharaan Gereja Efata</option>
      <option>Panitia Pembangunan dan Pemeliharaan Gereja Maranatha</option>
      <option>Panitia Pengadaan dan Pemeliharaan Tanah Pemakaman</option>
      <option>Panitia Natal Umum/Kategorial</option>
    </select>
  </label>

  <label>Nama Pengisi
    <input type="text" name="nama" placeholder="Nama lengkap" required>
  </label>

  <label>Laporan Kegiatan (opsional)
    <textarea name="laporan" placeholder="Tuliskan laporan kegiatan atau uraian singkat..."></textarea>
  </label>

  <fieldset>
    <legend>Usulan / Saran / Pendapat</legend>
    <div class="grid" id="gridUsulan"></div>
  </fieldset>

  <div class="actions">
    <button type="submit">Kirim Usulan</button>
    <button type="reset">Reset</button>
  </div>
</form>

<section>
  <h2>üìã Rekap Usulan yang Masuk</h2>
  <div style="text-align:center;">
    <button class="reload-btn" id="reloadBtn">üîÑ Reload Data</button>
  </div>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Kelompok</th>
          <th>Nama Pengisi</th>
          <th>Jumlah Usulan</th>
          <th>Status Laporan Kegiatan</th>
        </tr>
      </thead>
      <tbody id="rekapBody"></tbody>
    </table>
  </div>
  <p id="statusMsg">‚è≥ Memuat data...</p>
</section>
</main>

<footer>
  &copy; <span id="year"></span> MPHJ GKE Yerusalem Tamiang Layang
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHCQ_5BGfWSTnGY3Si0DOMP9MIrmhtJT7I8N0pvuR3T8IZ_sL9kCwiV0qAbJZRf2EGiIr33W9QVMsT/pub?gid=0&single=true&output=csv";
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZvPS36yi1Mi_CKfm05I5t4jcoNtbm2AJCNoj3Za6jndFz_s8KMVpRQLGMoHeiFE7Z/exec";
  const tableBody = document.getElementById("rekapBody");
  const statusMsg = document.getElementById("statusMsg");
  const reloadBtn = document.getElementById("reloadBtn");
  const form = document.getElementById("usulanForm");
  document.getElementById("year").textContent = new Date().getFullYear();

  let existingNames = [];

  // ‚úÖ Generate Usulan 1‚Äì10 otomatis
  const grid = document.getElementById("gridUsulan");
  for (let i = 1; i <= 10; i++) {
    const lbl = document.createElement("label");
    lbl.innerHTML = `Usulan ${i}<input type='text' name='usulan${i}' placeholder='Masukkan usulan ke-${i}' />`;
    grid.appendChild(lbl);
  }

  function formatTanggal(tgl) {
    if (!tgl || !/^\d{4}-\d{2}-\d{2}$/.test(tgl)) return tgl;
    const [y, m, d] = tgl.split("-");
    const bulan = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
    return `${d} ${bulan[parseInt(m)-1]} ${y}`;
  }

  form.addEventListener("submit", async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());
    const namaInput = data.nama.trim().toLowerCase();
    if (existingNames.includes(namaInput)) {
      alert("‚ö†Ô∏è Nama yang sama sudah pernah mengirim usulan.\nSilakan gunakan nama lain atau hubungi panitia.");
      return;
    }

    try {
      await fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
      alert("‚úÖ Usulan berhasil dikirim. Terima kasih!");
      form.reset();
      loadData();
    } catch {
      alert("‚ùå Gagal mengirim, periksa koneksi.");
    }
  });

  async function loadData() {
    try {
      tableBody.innerHTML = "";
      const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now());
      const text = (await res.text()).replace(/^\uFEFF/, "");

      function parseCSV(str) {
        const rows = [];
        let current = [], cell = "", inQuotes = false;
        for (let i = 0; i < str.length; i++) {
          const char = str[i];
          const next = str[i + 1];
          if (char === '"' && inQuotes && next === '"') { cell += '"'; i++; continue; }
          if (char === '"') { inQuotes = !inQuotes; continue; }
          if (char === ',' && !inQuotes) { current.push(cell); cell = ""; continue; }
          if ((char === '\n' || char === '\r') && !inQuotes) {
            if (cell || current.length) { current.push(cell); rows.push(current); }
            current = []; cell = "";
            continue;
          }
          cell += char;
        }
        if (cell || current.length) { current.push(cell); rows.push(current); }
        return rows;
      }

      const rows = parseCSV(text.trim());
      if (rows.length <= 1) { statusMsg.textContent = "‚ö†Ô∏è Tidak ada data."; return; }

      existingNames = rows.slice(1).map(r => (r[3] || "").trim().toLowerCase());

      rows.slice(1).forEach((cols, i) => {
        const id = cols[0] || i + 1;
        const tanggal = formatTanggal(cols[1]);
        const kelompok = cols[2] || "-";
        const nama = cols[3] || "-";
        const jumlah = cols.slice(4, 14).filter(x => x && x.trim() !== "").length;
        const laporan = cols[14] || "";
        const statusLaporan = laporan.trim() ? "‚úÖ Ada" : "‚ùå Tidak Ada";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${id}</td>
          <td>${tanggal}</td>
          <td>${kelompok}</td>
          <td>${nama}</td>
          <td style="text-align:center;">${jumlah}</td>
          <td style="text-align:center;">${statusLaporan}</td>`;
        tableBody.appendChild(tr);
      });

      statusMsg.textContent = "‚úÖ Data berhasil dimuat.";
    } catch {
      statusMsg.textContent = "‚ö†Ô∏è Gagal memuat data.";
    }
  }

  reloadBtn.addEventListener("click", loadData);
  loadData();
});
</script>
</body>
</html>
