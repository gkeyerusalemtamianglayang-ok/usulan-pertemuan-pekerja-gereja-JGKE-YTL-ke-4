<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Usulan & Masukan - Pra Pertemuan Pekerja Gereja ke-4 Tahun 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
  body {
    margin: 0;
    color: #222;
    background: linear-gradient(120deg, #fdfaff, #f7fbff, #fffdf5);
    background-size: 300% 300%;
    animation: bgShift 25s ease infinite;
    position: relative;
    overflow-x: hidden;
  }
  @keyframes bgShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .logo-bg {
    position: fixed;
    inset: 0;
    background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png') center/40% no-repeat;
    opacity: 0.07;
    z-index: -1;
    pointer-events: none;
    mix-blend-mode: soft-light;
  }

  header {
    position: relative;
    text-align: center;
    color: white;
    padding: 2.3rem 1rem;
    overflow: hidden;
    background: linear-gradient(270deg, #1e3a8a, #4c1d95, #9333ea, #2563eb);
    background-size: 400% 400%;
    animation: headerAurora 20s ease infinite;
  }
  @keyframes headerAurora {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  header::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150px;
    height: 150px;
    background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png') no-repeat center/contain;
    opacity: 0.12;
    transform: translate(-50%, -50%);
    animation: pulse 8s ease-in-out infinite alternate;
  }
  @keyframes pulse {
    from { filter: drop-shadow(0 0 5px rgba(255,255,255,0.4)); }
    to { filter: drop-shadow(0 0 25px rgba(255,255,255,0.9)); }
  }
  header h1 {
    font-size: clamp(1.3rem, 4vw, 1.8rem);
    font-weight: 600;
    text-shadow: 0 0 10px rgba(255,255,255,0.7);
    margin-bottom: 0.3rem;
  }
  header p {
    font-size: clamp(0.9rem, 3vw, 1rem);
    margin: 0;
    color: #eaf7ff;
  }

  main {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  main::before {
    content: "";
    position: absolute;
    top: 0;
    width: 120%;
    height: 120%;
    background: radial-gradient(circle at 30% 30%, #dbeafe80, transparent 60%),
                radial-gradient(circle at 70% 60%, #ede9fe80, transparent 70%),
                radial-gradient(circle at 50% 100%, #fff5f580, transparent 70%);
    animation: waveMove 30s ease-in-out infinite alternate;
    z-index: 0;
  }
  @keyframes waveMove {
    0% { transform: translateY(0); }
    50% { transform: translateY(10px) scale(1.02); }
    100% { transform: translateY(-8px) scale(1.01); }
  }

  form, section {
    background: rgba(255,255,255,0.93);
    border-radius: 18px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    width: 92%;
    max-width: 880px;
    padding: 1.8rem;
    margin: 2rem auto 1.5rem;
    position: relative;
    z-index: 2;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 1.2s ease forwards;
  }
  @keyframes fadeInUp {
    to { opacity: 1; transform: translateY(0); }
  }

  label { display: flex; flex-direction: column; margin-bottom: 1rem; font-weight: 500; }
  input, select {
    margin-top: .4rem;
    padding: .7rem;
    border: 1px solid #ccc;
    border-radius: 10px;
    font-size: 1rem;
    transition: 0.25s ease;
  }
  input:focus, select:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 6px #93c5fd;
    outline: none;
  }

  fieldset { border: none; margin-top: 1rem; }
  legend { font-weight: 600; margin-bottom: .7rem; color: #1e3a8a; }
  .grid { display: grid; gap: .8rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }

  .actions {
    display: flex; justify-content: center; gap: 1rem;
    margin-top: 1.5rem; flex-wrap: wrap;
  }
  button {
    border: none; padding: .9rem 1.6rem; border-radius: 10px;
    cursor: pointer; font-weight: 600; color: #fff;
    background: linear-gradient(90deg, #2563eb, #7c3aed, #9333ea);
    background-size: 200% 200%;
    animation: btnMove 6s ease infinite;
    transition: transform .25s ease;
  }
  @keyframes btnMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  button:hover { transform: scale(1.05); box-shadow: 0 0 10px rgba(147,51,234,0.3); }

  .reload-btn {
    display: inline-block;
    background: linear-gradient(90deg, #059669, #10b981);
    margin-bottom: 0.8rem;
  }

  table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background: #c7d2fe; color: #1e1e1e; }
  tr:nth-child(even) { background: #f3f4f6; }

  #statusMsg { text-align: center; margin-top: 1rem; font-size: 0.85rem; color: #444; }

  footer {
    background: linear-gradient(90deg, #2563eb, #7c3aed, #9333ea);
    background-size: 600% 600%;
    animation: footerFlow 20s ease infinite;
    color: white; text-align: center;
    padding: 0.9rem; font-size: 0.85rem;
  }
  @keyframes footerFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @media (max-width: 768px) {
    form, section { width: 95%; padding: 1.2rem; }
    input, select { font-size: 0.9rem; padding: 0.6rem; }
    button { width: 100%; font-size: 0.95rem; }
    th, td { font-size: 0.85rem; padding: 6px; }
  }
</style>
</head>

<body>
<div class="logo-bg"></div>

<header>
  <h1>üïäÔ∏è Usulan, Masukan & Pendapat</h1>
  <p>Pra Pertemuan Pekerja Gereja ke-4 Tahun 2025</p>
  <p>Jemaat GKE Yerusalem Tamiang Layang</p>
</header>

<main>
<form id="usulanForm">
  <label>Tanggal
    <input type="date" name="tanggal" required>
  </label>

  <label>Kelompok Pekerja Gereja
    <select name="kelompok" required>
      <option value="">-- Pilih Kelompok --</option>
      <option>Pendeta/Vicaris</option>
      <option>BPP</option>
      <option>Pengurus Lingkungan Sion</option>
      <option>Pengurus Lingkungan Betlehem</option>
      <option>Pengurus Lingkungan Betania</option>
      <option>Pengurus Lingkungan Siloam</option>
      <option>Seksi Pelayanan Anak</option>
      <option>Seksi Pelayanan Remaja dan Pemuda</option>
      <option>Seksi Pelayanan Perempuan</option>
      <option>Seksi Pelayanan Bapak</option>
      <option>Seksi Pelayanan Lansia</option>
      <option>Tim Multimedia</option>
      <option>Tim Musik</option>
      <option>Song Leaders</option>
      <option>Operator LCD</option>
      <option>Operator Sound System</option>
      <option>Organis/Pemain Musik</option>
      <option>Koster Gereja Efata</option>
      <option>Koster Gereja Maranatha</option>
      <option>Panitia Pembangunan dan Pemeliharaan Gereja Efata</option>
      <option>Panitia Pembangunan dan Pemeliharan Gereja Maranatha</option>
      <option>Panitia Pengadaan dan Pemeliharaan Tanah Pemakaman</option>
      <option>Panitia Natal Umum/Kategorial</option>
    </select>
  </label>

  <label>Nama Pengisi
    <input type="text" name="nama" placeholder="Nama lengkap" required>
  </label>

  <fieldset>
    <legend>Usulan / Saran / Pendapat</legend>
    <div class="grid" id="gridUsulan"></div>
  </fieldset>

  <div class="actions">
    <button type="submit">Kirim Usulan</button>
    <button type="reset">Reset</button>
  </div>
</form>

<section>
  <h2>üìã Rekap Usulan yang Masuk</h2>
  <div style="text-align:center;">
    <button class="reload-btn" id="reloadBtn">üîÑ Reload Data</button>
  </div>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Kelompok</th>
          <th>Nama Pengisi</th>
          <th>Jumlah Usulan</th>
        </tr>
      </thead>
      <tbody id="rekapBody"></tbody>
    </table>
  </div>
  <p id="statusMsg">‚è≥ Memuat data...</p>
</section>
</main>

<footer>
  &copy; <span id="year"></span> MPHJ GKE Yerusalem Tamiang Layang
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHCQ_5BGfWSTnGY3Si0DOMP9MIrmhtJT7I8N0pvuR3T8IZ_sL9kCwiV0qAbJZRf2EGiIr33W9QVMsT/pub?gid=0&single=true&output=csv";
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZvPS36yi1Mi_CKfm05I5t4jcoNtbm2AJCNoj3Za6jndFz_s8KMVpRQLGMoHeiFE7Z/exec";
  const tableBody = document.getElementById("rekapBody");
  const statusMsg = document.getElementById("statusMsg");
  const reloadBtn = document.getElementById("reloadBtn");
  const form = document.getElementById("usulanForm");
  document.getElementById("year").textContent = new Date().getFullYear();

  let existingNames = [];

  const grid = document.getElementById("gridUsulan");
  for (let i = 1; i <= 10; i++) {
    const lbl = document.createElement("label");
    lbl.innerHTML = `Usulan ${i}<input type='text' name='usulan${i}' placeholder='Masukkan usulan ke-${i}' />`;
    grid.appendChild(lbl);
  }

  function formatTanggal(tgl) {
    if (!tgl || !/^\d{4}-\d{2}-\d{2}$/.test(tgl)) return tgl;
    const [y, m, d] = tgl.split("-");
    const bulan = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
    return `${d} ${bulan[parseInt(m)-1]} ${y}`;
  }

  form.addEventListener("submit", async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());
    const namaInput = data.nama.trim().toLowerCase();
    if (existingNames.includes(namaInput)) {
      alert("‚ö†Ô∏è Nama yang sama sudah pernah mengirim usulan.\nSilakan gunakan nama lain atau hubungi panitia.");
      return;
    }

    try {
      await fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
      alert("‚úÖ Usulan berhasil dikirim. Terima kasih!");
      form.reset();
      loadData();
    } catch {
      alert("‚ùå Gagal mengirim, periksa koneksi.");
    }
  });

  async function loadData() {
    try {
      tableBody.innerHTML = "";
      const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now());
      const text = (await res.text()).replace(/^\uFEFF/, "");
      const rows = text.trim().split(/\r?\n/).map(r => r.split(","));
      if (rows.length <= 1) { statusMsg.textContent = "‚ö†Ô∏è Tidak ada data."; return; }
      existingNames = rows.slice(1).map(r => (r[3] || "").trim().toLowerCase());

      rows.slice(1).forEach((cols, i) => {
        const id = cols[0] || i + 1;
        const tanggal = formatTanggal(cols[1]);
        const kelompok = cols[2] || "-";
        const nama = cols[3] || "-";
        const jumlah = cols.slice(4, 14).filter(x => x && x.trim() !== "").length;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${id}</td><td>${tanggal}</td><td>${kelompok}</td><td>${nama}</td><td style="text-align:center;">${jumlah}</td>`;
        tableBody.appendChild(tr);
      });
      statusMsg.textContent = "‚úÖ Data berhasil dimuat.";
    } catch {
      statusMsg.textContent = "‚ö†Ô∏è Gagal memuat data.";
    }
  }

  reloadBtn.addEventListener("click", loadData);
  loadData();
});
</script>
</body>
</html>
