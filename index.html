<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Usulan/Masukan/Saran/Pendapat untuk Pertemuan Pekerja Gereja ke-4 Tahun 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root { --shadow: rgba(0,0,0,0.25); }
  * { box-sizing: border-box; }

  body {
    margin: 0;
    color: #fff;
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
    background: #000;
  }

  /* === AURORA RAINBOW DYNAMIC === */
  .aurora {
    position: fixed;
    inset: -40%;
    z-index: -3;
    pointer-events: none;
    background: linear-gradient(120deg,
      #ff0000,
      #ffa500,
      #ffff00,
      #00ff00,
      #00ffff,
      #0000ff,
      #8a2be2,
      #ff00ff,
      #ff0000);
    background-size: 800% 800%;
    opacity: 0.55;
    filter: blur(110px) contrast(120%);
    animation: moveAurora 25s ease-in-out infinite alternate, hueSpin 40s linear infinite;
  }

  @keyframes moveAurora {
    0% { transform: translate(-10%, -8%) scale(1.05); background-position: 0% 50%; }
    50% { transform: translate(8%, 6%) scale(1.08); background-position: 100% 50%; }
    100% { transform: translate(-6%, 8%) scale(1.04); background-position: 0% 50%; }
  }
  @keyframes hueSpin {
    from { filter: hue-rotate(0deg) blur(110px) contrast(120%); }
    to { filter: hue-rotate(360deg) blur(110px) contrast(120%); }
  }

  /* === LOGO BACKGROUND === */
  .logo-bg {
    position: fixed;
    inset: 0;
    background: url('https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png') center/contain no-repeat;
    mix-blend-mode: soft-light;
    opacity: 0.15;
    z-index: -2;
  }

  /* === HEADER === */
  header { text-align: center; margin-top: 2rem; }
  header img { width: 85px; border-radius: 50%; box-shadow: 0 0 10px #ffffff33; }
  h1 { margin: .6rem 0 0; font-size: 1.7rem; font-weight: 600; }
  header p { margin: .2rem 0 1.5rem; color: #e2ffff; }

  /* === FORM === */
  form {
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    box-shadow: 0 8px 25px var(--shadow);
    width: 90%; max-width: 780px;
    padding: 2rem; margin-bottom: 3rem;
  }
  label { display: flex; flex-direction: column; margin-bottom: 1rem; font-weight: 500; }
  input, select {
    margin-top: .4rem; padding: .7rem;
    border: none; border-radius: 10px;
    font-size: 1rem; background: rgba(255,255,255,0.95); color: #333;
  }
  fieldset { border: none; margin-top: 1rem; }
  legend { font-weight: 600; margin-bottom: .5rem; }
  .grid { display: grid; gap: .7rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
  .actions { display: flex; justify-content: center; gap: 1rem; margin-top: 1.5rem; }

  button {
    border: none; padding: .9rem 1.6rem; border-radius: 12px;
    cursor: pointer; font-weight: 600; color: #fff;
    background: linear-gradient(270deg,#ff0000,#ff8000,#ffff00,#00ff00,#00ffff,#0000ff,#8a2be2,#ff00ff,#ff0000);
    background-size: 600% 600%;
    animation: btnAurora 10s linear infinite;
  }
  @keyframes btnAurora {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  button:hover { transform: scale(1.05); }
  footer { text-align: center; margin-top: auto; padding: 1rem; color: #f0faff; opacity: .9; }

  /* === TABEL REKAP === */
  table {
    width: 100%;
    border-collapse: collapse;
    color: #fff;
    font-size: 0.95rem;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
  }
  th {
    background: rgba(255,255,255,0.25);
    text-align: left;
  }
  tr:nth-child(even) { background: rgba(255,255,255,0.06); }
  tr:nth-child(odd) { background: rgba(255,255,255,0.12); }

</style>
</head>

<body>
<div class="aurora"></div>
<div class="logo-bg"></div>

<header>
  <img src="https://upload.wikimedia.org/wikipedia/commons/2/2e/LOGO_GKE.png" alt="Logo GKE">
  <h1>Usulan Pra Pertemuan Pekerja Gereja ke-4 Tahun 2025</h1>
  <p>Jemaat GKE Yerusalem Tamiang Layang</p>
</header>

<form id="usulanForm">
  <label>Tanggal
    <input type="date" name="tanggal" required>
  </label>

  <label>Kelompok Pekerja Gereja
    <select name="kelompok" required>
      <option value="">-- Pilih Kelompok --</option>
      <option>Pendeta/Vicaris</option>
      <option>BPP</option>
      <option>Pengurus Lingkungan Sion</option>
      <option>Pengurus Lingkungan Betlehem</option>
      <option>Pengurus Lingkungan Betania</option>
      <option>Pengurus Lingkungan Siloam</option>
      <option>Seksi Pelayanan Anak</option>
      <option>Seksi Pelayanan Remaja dan Pemuda</option>
      <option>Seksi Pelayanan Perempuan</option>
      <option>Seksi Pelayanan Bapak</option>
      <option>Seksi Pelayanan Lansia</option>
      <option>Operator LCD</option>
      <option>Organis/Pemain Musik</option>
      <option>Song Leaders</option>
      <option>Tim Musik</option>
      <option>Tim Multimedia</option>
      <option>Koster Gereja Efata</option>
      <option>Koster Gereja Maranatha</option>
      <option>Panitia Pembangunan dan Pemeliharaan Gereja Efata</option>
      <option>Panitia Pembangunan dan Pemeliharaan Gereja Maranatha</option>
      <option>Panitia Pengadaan dan Pemeliharaan Tanah Pemakaman</option>
    </select>
  </label>

  <label>Nama Pengisi
    <input type="text" name="nama" placeholder="Nama lengkap" required>
  </label>

  <fieldset>
    <legend>Usulan / Pendapat / Masukan</legend>
    <div class="grid" id="gridUsulan"></div>
  </fieldset>

  <div class="actions">
    <button type="submit">Kirim Usulan</button>
    <button type="reset" class="secondary">Reset</button>
  </div>
</form>

<section style="width:90%;max-width:900px;background:rgba(255,255,255,0.08);backdrop-filter:blur(10px);border-radius:20px;box-shadow:0 4px 20px rgba(0,0,0,.25);padding:1.5rem;margin-bottom:2rem;">
  <h2 style="text-align:center;margin-bottom:1rem;display:flex;align-items:center;justify-content:center;gap:.4rem;">
    üìä <span>Rekap Usulan yang Masuk</span>
  </h2>
  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Kelompok Pekerja</th>
          <th>Nama Pengisi</th>
          <th style="text-align:center;">Jumlah Usulan</th>
        </tr>
      </thead>
      <tbody id="rekapBody"></tbody>
    </table>
  </div>
  <p id="statusMsg" style="text-align:center;margin-top:1rem;font-size:.85rem;opacity:.9;">
    ‚úÖ Data berhasil dimuat dari Google Sheet.
  </p>
</section>

<footer>&copy; <span id="year"></span> MPHJ GKE Yerusalem Tamiang Layang</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHCQ_5BGfWSTnGY3Si0DOMP9MIrmhtJT7I8N0pvuR3T8IZ_sL9kCwiV0qAbJZRf2EGiIr33W9QVMsT/pub?gid=0&single=true&output=csv";
  const tableBody = document.getElementById("rekapBody");
  const statusMsg = document.getElementById("statusMsg");
  document.getElementById('year').textContent = new Date().getFullYear();

  // ‚úÖ Generate 10 kolom usulan otomatis (dijalankan setelah DOM siap)
  const grid = document.getElementById('gridUsulan');
  for (let i = 1; i <= 10; i++) {
    const lbl = document.createElement('label');
    lbl.innerHTML = `Usulan ${i}<input type='text' name='usulan${i}' placeholder='Masukkan usulan ke-${i}' />`;
    grid.appendChild(lbl);
  }

  // Fungsi ubah format tanggal ke format Indonesia
  function formatTanggal(tgl) {
    if (!tgl || !/^\d{4}-\d{2}-\d{2}$/.test(tgl)) return tgl;
    const [y, m, d] = tgl.split("-");
    const bulan = [
      "Januari","Februari","Maret","April","Mei","Juni",
      "Juli","Agustus","September","Oktober","November","Desember"
    ];
    return `${d} ${bulan[parseInt(m)-1]} ${y}`;
  }

  // Kirim data ke Apps Script
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZvPS36yi1Mi_CKfm05I5t4jcoNtbm2AJCNoj3Za6jndFz_s8KMVpRQLGMoHeiFE7Z/exec";
  document.getElementById('usulanForm').addEventListener('submit', async e => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    try {
      await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
      alert('‚úÖ Usulan berhasil dikirim. Terima kasih!');
      e.target.reset();
    } catch (err) {
      alert('‚ùå Gagal mengirim, periksa koneksi.');
      console.error(err);
    }
  });

  // Load data dari Google Sheet
  async function loadData() {
    try {
      tableBody.innerHTML = "";
      statusMsg.textContent = "‚è≥ Memuat data...";
      const res = await fetch(SHEET_CSV_URL + "&t=" + Date.now());
      const text = (await res.text()).replace(/^\uFEFF/, "");
      const rows = text.trim().split(/\r?\n/).map(r => r.split(","));
      if (rows.length <= 1) {
        statusMsg.textContent = "‚ö†Ô∏è Tidak ada data ditemukan.";
        return;
      }

      rows.slice(1).forEach((cols, i) => {
        if (cols.length < 14) return;
        const id = cols[0] || i + 1;
        const tanggal = formatTanggal(cols[1]);
        const kelompok = cols[2] || "-";
        const nama = cols[3] || "-";
        const usulans = cols.slice(4, 14);
        const jumlah = usulans.filter(x => x && x.trim() !== "").length;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${id}</td>
          <td>${tanggal}</td>
          <td>${kelompok}</td>
          <td>${nama}</td>
          <td style="text-align:center;">${jumlah}</td>`;
        tableBody.appendChild(tr);
      });

      statusMsg.innerHTML = "‚úÖ <b>Data berhasil dimuat dari Google Sheet.</b>";
    } catch (err) {
      console.error(err);
      statusMsg.textContent = "‚ö†Ô∏è Gagal memuat data, periksa koneksi atau izin Sheet.";
    }
  }

  loadData();
});
</script>
</body>
</html>
